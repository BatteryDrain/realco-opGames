LINKS = ["https://store.steampowered.com/app/3417410/Storebound/https://store.steampowered.com/app/3417410/Storebound/",
    "https://store.steampowered.com/app/3179350/Long_Drive_North_CoOp_RV_Simulator/",
    "https://store.steampowered.com/app/3044440/Gas_Station_Manager/",
    "https://store.steampowered.com/app/3099730/Beat_Around_The_Bush/",
    "https://store.steampowered.com/app/1431300/Sand/",
    "https://store.steampowered.com/app/1133870/Space_Engineers_2/",
    "https://store.steampowered.com/app/1833200/DuneCrawl/",
    "https://store.steampowered.com/app/1931180/Lost_Skies/",
    "https://store.steampowered.com/app/2909110/Nuclear_Nightmare/",
    "https://store.steampowered.com/app/3241660/REPO/",
    "https://store.steampowered.com/app/2192380/Begone_Beast/",
    "https://store.steampowered.com/app/2681030/Outbound/",
    "https://store.steampowered.com/app/2977620/Squirreled_Away/",
    "https://store.steampowered.com/app/1641960/Forever_Skies/",
    "https://store.steampowered.com/app/1757300/Jump_Ship/",
    "https://store.steampowered.com/app/1631270/StarRupture/",
    "https://store.steampowered.com/app/3079190/PACS__Post_Apocalypse_Courier_Service_Coop_Delivery_Simulator/",
    "https://store.steampowered.com/app/2929250/over_the_hill/",
    "https://store.steampowered.com/app/1172710/Dune_Awakening/",
    "https://store.steampowered.com/app/905340/Heave_Ho/",
    "https://store.steampowered.com/app/418530/Spelunky_2/",
    "https://store.steampowered.com/app/661940/Regular_Human_Basketball/",
    "https://store.steampowered.com/app/2644470/PICO_PARK_2/",
    "https://store.steampowered.com/app/303590/Hidden_in_Plain_Sight/",
    "https://store.steampowered.com/app/2708450/Oh_Deer/",
    "https://store.steampowered.com/app/1962700/Subnautica_2",
    "https://store.steampowered.com/app/3113750/Drunk_Builder_Simulator/",
    "https://store.steampowered.com/app/2780980/LOCKDOWN_Protocol/",
    "https://store.steampowered.com/app/1601330/Survival_Machine/",
    "https://store.steampowered.com/app/236390/War_Thunder/",
    "https://store.steampowered.com/app/2569760/The_Mound_Omen_of_Cthulhu/",
    "https://store.steampowered.com/app/1172620/Sea_of_Thieves_2025_Edition/",
    "https://store.steampowered.com/app/2698870/Midnight_Murder_Club/",
    "https://store.steampowered.com/app/3041230/Crosswind/",
    "https://store.steampowered.com/app/2820700/A_Gentlemens_Dispute/",
    "https://store.steampowered.com/app/2104890/RoadCraft/",
    "https://store.steampowered.com/app/1660080/Aloft/",
    "https://store.steampowered.com/app/2842150/Pair_A_Dice/",
    "https://store.steampowered.com/app/2253100/Everwind/",
    "https://store.steampowered.com/app/1084600/My_Time_at_Sandrock/",
    "https://store.steampowered.com/app/2592220/CUFFBUST/",
    "https://store.steampowered.com/app/1017180/The_Long_Drive/",
    "https://store.steampowered.com/app/3558400/Backseat_Drivers/",
    "https://store.steampowered.com/app/2852700/BUS_Bro_u_Survived/",
    "https://store.steampowered.com/app/934700/Dead_Island_2/",
    "https://store.steampowered.com/app/2551020/Onearmed_robber/",
    "https://store.steampowered.com/app/2879840/Escape_Simulator_2/",
    "https://store.steampowered.com/app/2788040/Another_Try_2/"
    ];
NAMES = [["Storebound", 1, 0, 0, 0],
    ["Long Drive North", 1, 0, 0, 1],
    ["Gas Station Manager", 1, 1, 0, 2],
    ["Beat Around The Bush", 1, 0, 0, 3],
    ["SAND", 1, 0, 0, 4],
    ["Space Engineers 2", 1, 0, 0, 5],
    ["DuneCrawl", 1, 0, 0, 6],
    ["Lost Skies", 1, 0, 0, 7],
    ["Nuclear Nightmare", 1, 0, 0, 8],
    ["REPO", 1, 0, 0, 9],
    ["Begone Beast", 1, 0, 0, 10],
    ["Outbound", 1, 0, 0, 11],
    ["Squirreled Away", 1, 0, 0, 12],
    ["Forever Skies", 1, 0, 0, 13],
    ["Jump Ship", 1, 0, 0, 14],
    ["StarRupture", 1, 0, 0, 15],
    ["PACS", 1, 0, 0, 16],
    ["over the hill", 1, 0, 0, 17],
    ["Dune Awakening", 1, 0, 0, 18],
    ["Heave Ho", 1, 1, 0, 19],
    ["Spelunky 2", 1, 0, 0, 20],
    ["Regular Human Basketball", 1, 1, 1, 21],
    ["PICO PARK 2", 1, 1, 0, 22],
    ["Hidden in Plain Sight", 1, 1, 1, 23],
    ["Oh Deer", 1, 0, 0, 24],
    ["Subnautica 2", 1, 0, 0, 25],
    ["Drunk Builder Simulator", 1, 0, 0, 26],
    ["LOCKDOWN Protocol", 1, 0, 0, 27],
    ["Survival Machine", 1, 0, 0, 28],
    ["War Thunder", 1, 1, 1, 29],
    ["The Mound: Omen of Cthulhu", 1, 1, 1, 30],
    ["Sea of Thieves", 1, 0, 0, 31],
    ["Midnight Murder Club,", 1, 0, 0, 32],
    ["Crosswind", 1, 0, 0, 33],
    ["A Gentlemen's Dispute", 1, 1, 0, 34],
    ["RoadCraft", 1, 0, 0, 35],
    ["Aloft", 1, 0, 0, 36],
    ["Pair A Dice", 1, 0, 0, 37],
    ["Everwind", 1, 0, 0, 38],
    ["My Time at sandrock", 1, 0, 0, 39],
    ["CUFFBUST", 1, 0, 0, 40],
    ["The Long Drive", 1, 0, 0, 41],
    ["Backseat Drivers", 1, 0, 0, 42],
    ["BUS: Bro u Survived", 1, 0, 0, 43],
    ["Dead Island 2", 1, 0, 0, 44],
    ["One-armed robber", 1, 0, 0, 45],
    ["Escape Simulator 2", 1, 0, 0, 46],
    ["Another Try 2", 1, 0, 0, 47]
    ]; // name, windows, apple, linux, link/picture/status index
NAMESAZ = [["Aloft", 1, 0, 0, 36],
    ["Another Try 2", 1, 0, 0, 47],
    ["A Gentlemen's Dispute", 1, 1, 0, 34],
    ["Badlands crew", 1, 0, 0, 41],
    ["Backseat Drivers", 1, 0, 0, 42],
    ["Beat Around The Bush", 1, 0, 0, 3],
    ["Begone Beast", 1, 0, 0, 10],
    ["BUS: Bro u Survived", 1, 0, 0, 43],
    ["Crosswind", 1, 0, 0, 33],
    ["CUFFBUST", 1, 0, 0, 40],
    ["Dead Island 2", 1, 0, 0, 44],
    ["Drunk Builder Simulator", 1, 0, 0, 26],
    ["Dune Awakening", 1, 0, 0, 18],
    ["DuneCrawl", 1, 0, 0, 6],
    ["Escape Simulator 2", 1, 0, 0, 46],
    ["Everwind", 1, 0, 0, 38],
    ["Forever Skies", 1, 0, 0, 13],
    ["Gas Station Manager", 1, 1, 0, 2],
    ["Heave Ho", 1, 1, 0, 19],
    ["Hidden in Plain Sight", 1, 1, 1, 23],
    ["Jump Ship", 1, 0, 0, 14],
    ["LOCKDOWN Protocol", 1, 0, 0, 27],
    ["Long Drive North", 1, 0, 0, 1],
    ["Lost Skies", 1, 0, 0, 7],
    ["Midnight Murder Club,", 1, 0, 0, 32],
    ["My Time at sandrock", 1, 0, 0, 39],
    ["Nuclear Nightmare", 1, 0, 0, 8],
    ["Oh Deer", 1, 0, 0, 24],
    ["One-armed robber", 1, 0, 0, 45],
    ["Outbound", 1, 0, 0, 11],
    ["over the hill", 1, 0, 0, 17],
    ["PACS", 1, 0, 0, 16],
    ["Pair A Dice", 1, 0, 0, 37],
    ["PICO PARK 2", 1, 1, 0, 22],
    ["Regular Human Basketball", 1, 1, 1, 21],
    ["RoadCraft", 1, 0, 0, 35],
    ["REPO", 1, 0, 0, 9],
    ["SAND", 1, 0, 0, 4],
    ["Sea of Thieves", 1, 0, 0, 31],
    ["Space Engineers 2", 1, 0, 0, 5],
    ["Spelunky 2", 1, 0, 0, 20],
    ["Squirreled Away", 1, 0, 0, 12],
    ["StarRupture", 1, 0, 0, 15],
    ["Storebound", 1, 0, 0, 0],
    ["Subnautica 2", 1, 0, 0, 25],
    ["Survival Machine", 1, 0, 0, 28],
    ["The Mound: Omen of Cthulhu", 1, 1, 1, 30],
    ["War Thunder", 1, 1, 1, 29]
    ]; // name, windows, apple, linux, link/picture/status index
IMGS = ["assets/storebound.jpg",
    "assets/longdriven.jpg",
    "assets/gasstation.jpg",
    "assets/beatthebush.jpg",
    "assets/sand.jpg",
    "assets/space.jpg",
    "assets/DuneCrawl.jpg",
    "assets/lostskys.jpg",
    "assets/nnightmare.jpg",
    "assets/repo.jpg",
    "assets/beast.jpg",
    "assets/outbound.jpg",
    "assets/Squirreled.jpg",
    "assets/ForeverSkies.jpg",
    "assets/JumpShip.jpg",
    "assets/starrapture.jpg",
    "assets/pacs.jpg",
    "assets/overthehill.jpg",
    "assets/Duneawakening .jpg",
    "assets/HeaveHo.jpg",
    "assets/Spelunky.jpg",
    "assets/RegularHumanBasketball.jpg",
    "assets/PICOPARK.jpg",
    "assets/HiddeninPlainSight.jpg",
    "assets/OhDeer.jpg",
    "assets/Subnautica2.jpg",
    "assets/DrunkBuilderSimulator.jpg",
    "assets/LOCKDOWNProtocol.jpg",
    "assets/SurvivalMachine.jpg",
    "assets/WarThunder.jpg",
    "assets/TheMoundOmenofCthulhu.jpg",
    "assets/SeaofThieves.jpg",
    "assets/MidnightMurderClub.jpg",
    "assets/crosswind.jpg",
    "assets/aGentlemensDispute.jpg",
    "assets/RoadCraft.jpg",
    "assets/Aloft.jpg",
    "assets/PairADice.jpg",
    "assets/Everwind.jpg",
    "assets/Mytimeatsandrock.jpg",
    "assets/CUFFBUST.jpg",
    "assets/TheLongDrive.jpg",
    "assets/BackseatDrivers.jpg",
    "assets/BUSBrouSurvived.jpg",
    "assets/DeadIsland2.jpg",
    "assets/One-armedrobber.jpg",
    "assets/EscapeSimulator2.jpg",
    "assets/AnotherTry2.jpg"
    ];
STATUS = ["coming",
    "coming ex",
    "full",
    "full",
    "coming ex",
    "ex",
    "coming",
    "ex",
    "ex",
    "ex",
    "ex",
    "coming",
    "demo",
    "ex",
    "coming ex",
    "coming ex",
    "coming ex",
    "none",
    "ex",
    "full",
    "full",
    "full",
    "full",
    "full",
    "full",
    "coming",
    "full",
    "ex",
    "coming",
    "full",
    "coming",
    "full",
    "ex",
    "coming",
    "demo",
    "coming",
    "ex",
    "coming",
    "coming ex",
    "full",
    "comming",
    "full",
    "demo",
    "demo",
    "full",
    "full",
    "demo",
    "ex"
    ];
    PRICE = ["",
        "",
        "",
        "free",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "free",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "free",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "free",
        "",
        ""
        ];
COUNT = 0;
GAMEID = [];
ICONS = ["assets/Windows.svg.png","assets/Apple_white.svg.png","assets/linux-white-logo.png","assets/null.png"];
SYSTEM = "all";
let FIGURES = [];
FILTER = "all";
MOUSEX = 0;
MOUSEY = 0;
DARKMODE = true;
EXPANDED = false;
SORTBY = "date";
DELAY = 40;

const games = document.getElementById("games");

function clearf(){
    SORTBY = sorting.value;
    Iwanttosortby();
    filter.value = "all";
    FILTER = "all";

    sselect.value = "all";
    SYSTEM = "all";
    setcount();

    iconIndicator.src = "assets/null.png";
    //sort();
}

clearb.addEventListener("click", () => {
    clearf();
});

Iwanttosortby();
sorting.addEventListener("change", () => {
    clearf();
    setcount();
});

function Iwanttosortby(){
    if(SORTBY == "a-z"){
        games.innerHTML = "";

        for (let i = 0; i < NAMES.length; i++) {
            setTimeout((index) => figBuilderAZ(index), i * DELAY, i);
        }
    }
    if(SORTBY == "date"){
        games.innerHTML = "";

        for (let i = 0; i < NAMES.length; i++) {
            setTimeout((index) => figBuilderdate(index), i * DELAY, i);
        }
    }
}

function figBuilderAZ(i){
    fig = document.createElement('figure');
    fig.setAttribute("data-stat", STATUS[NAMESAZ[i][4]]);
    fig.setAttribute("data-windows", NAMESAZ[i][1]);
    fig.setAttribute("data-apple", NAMESAZ[i][2]);
    fig.setAttribute("data-linux", NAMESAZ[i][3]);

    title = document.createElement('figcaption');
    title.innerHTML = NAMESAZ[i][0];
    fig.appendChild(title);
    //console.log(NAMESAZ[i][0]);

    image = document.createElement('img');
    image.src = IMGS[NAMESAZ[i][4]];
    image.alt = "picture of " + NAMESAZ[i][0] + " gameplay";
    fig.appendChild(image);

    div1 = document.createElement('div');
    div1.id = "div1";

    but = document.createElement('button');
    but.innerHTML = "learn more";
    but.setAttribute("onclick", "goToLink(" + NAMESAZ[i][4] + ")");
    div1.appendChild(but);

    if(STATUS[NAMESAZ[i][4]] == "demo"){
        DEMO = document.createElement('img');
        DEMO.id = "demoimg";
        DEMO.src = "assets/DEMO.webp";
        DEMO.alt = "yellow rouned rectange with the word DEMO taken out of it";
        div1.appendChild(DEMO);
    }
    if(PRICE[NAMESAZ[i][4]] == "free"){
        FREE = document.createElement('img');
        FREE.id = "freeimg";
        FREE.src = "assets/FREEgreen.webp";
        div1.appendChild(FREE);
    }
    fig.appendChild(div1);

    div = document.createElement('div');
    div.classList.add("icon-container");
    for(j = 1; j < 4; j++){
        if(NAMESAZ[i][j] === 1){
            supimg = document.createElement('img');
            supimg.src = ICONS[j - 1];
            supimg.alt = "Platform Icon";
            div.classList.add("icon");
            div.appendChild(supimg);
        }
    }
    fig.appendChild(div);

    games.appendChild(fig);

    if((i + 1) == NAMESAZ.length){
        setFigures();
        setcount();
    }
}


function figBuilderdate(i){
    fig = document.createElement('figure');
    fig.setAttribute("data-stat", STATUS[NAMES[i][4]]);
    fig.setAttribute("data-windows", NAMES[i][1]);
    fig.setAttribute("data-apple", NAMES[i][2]);
    fig.setAttribute("data-linux", NAMES[i][3]);

    title = document.createElement('figcaption');
    title.innerHTML = NAMES[i][0];
    fig.appendChild(title);
    //console.log(NAMES[i][0]);

    image = document.createElement('img');
    image.src = IMGS[NAMES[i][4]];
    image.alt = "picture of " + NAMES[i][0] + " gameplay";
    fig.appendChild(image);

    div1 = document.createElement('div');
    div1.id = "div1";

    but = document.createElement('button');
    but.innerHTML = "learn more";
    but.setAttribute("onclick", "goToLink(" + NAMES[i][4] + ")");
    div1.appendChild(but);

    if(STATUS[NAMES[i][4]] == "demo"){
        DEMO = document.createElement('img');
        DEMO.id = "demoimg";
        DEMO.src = "assets/DEMO.webp";
        div1.appendChild(DEMO);
    }
    if(PRICE[NAMES[i][4]] == "free"){
        FREE = document.createElement('img');
        FREE.id = "freeimg";
        FREE.src = "assets/FREEgreen.webp";
        div1.appendChild(FREE);
    }
    fig.appendChild(div1);

    div = document.createElement('div');
    div.classList.add("icon-container");
    for(j = 1; j < 4; j++){
        if(NAMES[i][j] === 1){
            supimg = document.createElement('img');
            supimg.src = ICONS[j - 1];
            supimg.alt = "Platform Icon";
            div.classList.add("icon");
            div.appendChild(supimg);
        }
    }
    fig.appendChild(div);

    games.appendChild(fig);

    if((i + 1) == NAMES.length){
        setFigures();
        setcount();
    }
}




function goToLink(number){
    console.log("button " + number + " clicked");
    window.open(LINKS[number],"_blank");
}

function setFigures(){
    FIGURES = document.querySelectorAll("figure");
    console.log(FIGURES);
}
const filter = document.getElementById("filter");

sselect.addEventListener("change", () => {
    SYSTEM = sselect.value;
    console.log(SYSTEM);
    sort();
    if(SYSTEM == "all"){
        iconIndicator.src = ICONS[3];
    }
    if(SYSTEM == "linux"){
        iconIndicator.src = ICONS[2];
    }
    if(SYSTEM == "apple"){
        iconIndicator.src = ICONS[1];
    }
    if(SYSTEM == "windows"){
        iconIndicator.src = ICONS[0];
    }
    setcount();
});

filter.addEventListener("change", () => {
    FILTER = filter.value;
    console.log(FILTER);
    sort();
    setcount();
});

function sort(){
    for(i = 0; i < FIGURES.length; i++){
        if(FIGURES[i].classList.contains("hide")){
            FIGURES[i].classList.toggle("hide");
        }
    }
    if(FILTER != "all"){
        for(i = 0; i < FIGURES.length; i++){
            if(FIGURES[i].dataset.stat != FILTER){
                FIGURES[i].classList.toggle("hide");
            }
        }
    }

    if(SYSTEM == "linux"){
        for(i = 0; i < FIGURES.length; i++){
            if(FIGURES[i].dataset.linux == "0" && !FIGURES[i].classList.contains("hide")){
                FIGURES[i].classList.toggle("hide");
            }
        }
    }

    if(SYSTEM == "apple"){
        for(i = 0; i < FIGURES.length; i++){
            if(FIGURES[i].dataset.apple == "0" && !FIGURES[i].classList.contains("hide")){
                FIGURES[i].classList.toggle("hide");
            }
        }
    }

    if(SYSTEM == "windows"){
        for(i = 0; i < FIGURES.length; i++){
            if(FIGURES[i].dataset.windows == "0" && !FIGURES[i].classList.contains("hide")){
                FIGURES[i].classList.toggle("hide");
            }
        }
    }
}

darkmode.addEventListener("change", () => {
    if(DARKMODE){
        DARKMODE = false;
        document.body.style.backgroundColor = "white";
        darkmodelab.innerHTML = "dark mode:";
    }
    else{
        DARKMODE = true;
        document.body.style.backgroundColor = "black";
                darkmodelab.innerHTML = "light mode:";
    }

});

expand.addEventListener("click", function(){
    exheader();
});

window.addEventListener("scroll", () => {
    if(EXPANDED){
        exheader();
    }
});

function headshowhide(){
    filter.classList.toggle("hide");
    filterlab.classList.toggle("hide");
    sselect.classList.toggle("hide");
    sselectlab.classList.toggle("hide");
    iconIndicator.classList.toggle("hide");
    sorting.classList.toggle("hide");
    sortinglab.classList.toggle("hide");
    clearb.classList.toggle("hide");
}

function exheader(){
    header.classList.toggle("expanded");
    if(EXPANDED){
        expand.innerHTML = "show filters";
        headshowhide();
        EXPANDED = false;
        setcount();
    }
    else{
        expand.innerHTML = "hide filters";
        setTimeout(headshowhide(), 1000);
        EXPANDED = true;
    }
}

// function getPrices(gameid) {
//     const proxyURL = "https://cors-anywhere.herokuapp.com/";
//     const apiURL = `https://store.steampowered.com/api/appdetails?appids=${gameid}`;

//     fetch(proxyURL + apiURL)
//         .then(response => {
//             if (!response.ok) {
//                 throw new Error("Network response was not OK");
//             }
//             return response.json();
//         })
//         .then(data => {
//             console.log(data);
//             return data[gameid].data.is_free;
//         })
//         .catch(error => {
//             console.error("Error:", error);
//         });
// }

function getPrices(gameid){
    apiURL = "https://store.steampowered.com/api/appdetails?appids=" + gameid;
    fetch(apiURL)
        .then(response => {
            if(!response.ok) {
                throw new Error("Network response was not OK");
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            var Lprice = data;
            console.log(Lprice.discount_percent);
            return(gameid.is_free);
        })
        .catch(error => {
            console.error("Error:", error);
        });
}

for(i = 0; i < LINKS.length; i++){
    tempLink = LINKS[i];
    temp = "";
    for(index = 35; index < 43; index++){
        letter = tempLink.substr(index,1);
        if(letter !== "/"){
            temp += letter;
        }
    }
    GAMEID.push(temp);
}
for(i = 0; i < PRICE.length; i++){

}

function setcount(){
    COUNT = FIGURES.length
    for(i = 0; i < FIGURES.length; i++){
        if(FIGURES[i].classList.contains("hide")){
            COUNT--
        }
    }
    count.innerHTML=COUNT;
}